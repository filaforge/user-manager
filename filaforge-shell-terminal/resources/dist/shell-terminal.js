var FilaShellTerminal=(()=>{(function(){"use strict";class d{constructor(){this.currentCommand="",this.commandHistory=[],this.historyIndex=-1,this.currentPath="",this.isInitialized=!1}addToHistory(t){t&&t.trim()&&this.commandHistory[this.commandHistory.length-1]!==t&&(this.commandHistory.push(t.trim()),this.commandHistory.length>50&&(this.commandHistory=this.commandHistory.slice(-50)))}getHistorySuggestions(t){return t?this.commandHistory.filter(e=>e.toLowerCase().includes(t.toLowerCase())).slice(0,10):[]}navigateHistory(t){return t==="up"?this.historyIndex===-1?this.historyIndex=this.commandHistory.length-1:this.historyIndex>0&&this.historyIndex--:t==="down"&&this.historyIndex>=0&&(this.historyIndex<this.commandHistory.length-1?this.historyIndex++:this.historyIndex=-1),this.commandHistory[this.historyIndex]||""}resetHistoryIndex(){this.historyIndex=-1}}class u{constructor(t,e){this.terminal=t,this.state=e,this.lastPromptAt=0}showPrompt(){let t=Date.now();t-this.lastPromptAt<50||(this.lastPromptAt=t,this.terminal.write("\x1B[34madmin@filament\x1B[0m:\x1B[36m~\x1B[0m$ "))}clearCurrentLine(){this.terminal.write("\x1B[2K\x1B[0G")}refreshPrompt(){this.clearCurrentLine(),this.showPrompt(),this.terminal.write(this.state.currentCommand)}writeWelcome(){this.terminal.writeln("\x1B[36mWelcome to Filament Shell Terminal\x1B[0m"),this.terminal.writeln("Tab = completion, \u2191/\u2193 = history, Ctrl+L = clear, Ctrl+C = cancel"),this.terminal.writeln(""),this.showPrompt()}clearScreen(){this.terminal.write("\x1B[2J\x1B[3J\x1B[H"),this.terminal.write("\x1B[2K\r"),this.showPrompt()}showError(t){this.terminal.writeln(`\x1B[31mError: ${t}\x1B[0m`)}showSuccess(t){this.terminal.writeln(`\x1B[32m${t}\x1B[0m`)}showInfo(t){this.terminal.writeln(`\x1B[36m${t}\x1B[0m`)}}class f{constructor(t,e,r,i){this.terminal=t,this.state=e,this.ui=r,this.livewireComponent=i}async executeCommand(t){if(!(!t||!t.trim()))try{this.state.addToHistory(t),this.state.resetHistoryIndex(),this.livewireComponent?(await this.livewireComponent.call("$set","data.command",t),await this.livewireComponent.call("run")):this.ui.showError("Livewire component not available")}catch(e){console.error("Command execution error:",e),this.ui.showError(e.message||"Unknown error occurred")}}handleTabCompletion(t){if(!t||!t.trim())return[];this.livewireComponent&&this.livewireComponent.call("getTabCompletion",t).then(e=>{if(e.length===1){let r=t.split(" ");r[r.length-1]=e[0],this.state.currentCommand=r.join(" "),this.ui.refreshPrompt()}else e.length>1&&(this.terminal.writeln(""),this.terminal.writeln(e.join("    ")),this.ui.showPrompt(),this.terminal.write(this.state.currentCommand))}).catch(e=>{console.error("Tab completion error:",e)})}}class w{constructor(t,e,r,i){this.terminal=t,this.state=e,this.ui=r,this.commandHandler=i}handleKeyEvent({key:t,domEvent:e}){let r=!e.altKey&&!e.ctrlKey&&!e.metaKey;switch(e.keyCode){case 13:this.handleEnter();break;case 8:this.handleBackspace();break;case 9:this.handleTab(e);break;case 38:this.handleArrowUp();break;case 40:this.handleArrowDown();break;case 67:e.ctrlKey&&this.handleCtrlC();break;case 76:e.ctrlKey&&(e.preventDefault(),this.handleCtrlL());break;default:r&&this.handlePrintable(t);break}}handleEnter(){let t=this.state.currentCommand;t.trim()&&(this.terminal.writeln(""),this.commandHandler.executeCommand(t),this.state.currentCommand="")}handleBackspace(){this.state.currentCommand.length>0&&(this.state.currentCommand=this.state.currentCommand.slice(0,-1),this.terminal.write("\b \b"))}handleTab(t){t.preventDefault(),this.commandHandler.handleTabCompletion(this.state.currentCommand)}handleArrowUp(){let t=this.state.navigateHistory("up");this.state.currentCommand=t,this.ui.refreshPrompt()}handleArrowDown(){let t=this.state.navigateHistory("down");this.state.currentCommand=t,this.ui.refreshPrompt()}handleCtrlC(){this.terminal.writeln("^C"),this.state.currentCommand="",this.ui.showPrompt()}handleCtrlL(){this.ui.clearScreen()}handlePrintable(t){this.state.currentCommand+=t,this.terminal.write(t)}}class y{constructor(t){this.terminal=t,this.currentTheme="dark"}applyTheme(){try{let t=document.querySelector(".ff-shell-terminal");if(!t)return;let e=getComputedStyle(t),r=document.documentElement.classList.contains("dark")||document.documentElement.dataset.theme==="dark",i=(e.getPropertyValue("--terminal-bg")||"").trim()||(r?"#0a0a0c":"#ffffff"),s=(e.getPropertyValue("--terminal-fg")||"").trim()||(r?"#ffffff":"#1e293b"),n=(e.getPropertyValue("--terminal-cursor")||"").trim()||s;this.terminal.options.theme={background:i,foreground:s,cursor:n,cursorAccent:n},this.currentTheme=r?"dark":"light"}catch(t){console.warn("Theme application failed:",t)}}watchThemeChanges(){try{new MutationObserver(()=>this.applyTheme()).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]});let e=window.matchMedia("(prefers-color-scheme: dark)");e&&e.addEventListener&&e.addEventListener("change",()=>this.applyTheme())}catch(t){console.warn("Theme watching failed:",t)}}}class b{constructor(){this.current=null,this.isRefreshing=!1}init(t,e){if(t.dataset.initialized!=="1")try{let r=new Terminal({cursorBlink:!0,theme:{background:"#0a0a0c",foreground:"#ffffff",cursor:"#ffffff",cursorAccent:"#ffffff"}}),i=new FitAddon.FitAddon,s=new WebLinksAddon.WebLinksAddon;r.loadAddon(i),r.loadAddon(s),r.open(t),i.fit();let n=new d,o=new u(r,n),c=new f(r,n,o,e),l=new w(r,n,o,c),m=new y(r);r.onKey(C=>l.handleKeyEvent(C)),this.setupResizeHandling(r,i,t),this.initializeUI(r,o,m),t._terminal=r,t.dataset.initialized="1",this.current={terminal:r,termEl:t,fitAddon:i,state:n,ui:o,commandHandler:c,keyboardHandler:l,themeManager:m},n.isInitialized=!0}catch(r){console.error("Failed to initialize terminal:",r)}}setupResizeHandling(t,e,r){window.addEventListener("resize",()=>{e&&e.fit()});let i=new ResizeObserver(()=>{e&&e.fit()});i.observe(r);let s=document.querySelector(".fi-terminal-container");s&&i.observe(s),document.fonts&&document.fonts.ready&&document.fonts.ready.then(()=>{e&&e.fit()})}initializeUI(t,e,r){r.applyTheme(),r.watchThemeChanges(),setTimeout(()=>{this.needsWelcomeMessage(t)&&e.writeWelcome()},100),setTimeout(()=>t.focus(),150)}needsWelcomeMessage(t){try{if(!t||!t.buffer||!t.buffer.active)return!0;let e=t.buffer.active.length;if(e===0)return!0;for(let r=0;r<Math.min(e,5);r++){let i=t.buffer.active.getLine(r);if(i&&i.translateToString().trim())return!1}return!0}catch{return!0}}refresh(){try{if(!this.current||!this.current.terminal||!this.current.ui||this.isRefreshing)return;this.isRefreshing=!0,this.current.ui.clearScreen(),this.current.terminal.focus(),setTimeout(()=>{this.isRefreshing=!1},50)}catch{this.isRefreshing=!1}}async clearAndRun(t){try{if(!this.current||!this.current.ui||!this.current.commandHandler)return;await this.current.commandHandler.executeCommand("clear"),await this.current.commandHandler.executeCommand(t)}catch(e){console.error("Clear and run failed:",e)}}insertCommand(t){try{if(!this.current||!this.current.state||!this.current.ui||!this.current.terminal)return;this.current.state.currentCommand=String(t??""),this.current.ui.refreshPrompt(),this.current.terminal.focus()}catch(e){console.error("Insert command failed:",e)}}async runCommand(t){try{if(!this.current||!this.current.commandHandler)return;await this.current.commandHandler.executeCommand(t)}catch(e){console.error("Run command failed:",e)}}}function h(){window.FilaShellTerminal||(window.FilaShellTerminal=new b)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h()})();})();
